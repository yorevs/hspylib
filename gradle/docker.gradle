/*
    Gradle docker integration extension
    Project: HSPyLib
    Created: 4th March, 2021
*/

/* Docker Containers -------------------------------------------------------- */
project.ext.containers = [
  'mysql', 'kafka'
]

/* Docker Tasks ------------------------------------------------------------- */

/* Start all containers as daemons */
task startContainers(type: Task) {
  group = 'Docker'
  description = 'Start all containers as daemons'
  doLast {
    containers.each { String container ->
      println "Starting container: ${container}"
      exec {
        workingDir = "${rootDir}/docker/${container}"
        commandLine 'docker compose', 'up', '--force-recreate', '--build', '--remove-orphans', '--detach'
      }
    }
  }
}

/* Stop and  remove all containers */
task stopContainers(type: Task) {
  group = 'Docker'
  description = 'Stop and  remove all containers'
  doLast {
    containers.each { String container ->
      println "Stopping container: ${container}"
      exec {
        workingDir = "${rootDir}/docker/${container}"
        commandLine 'docker compose', 'down'
      }
    }
  }
}
