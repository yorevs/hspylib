/*
    Gradle Oracle integration
    Project: HSPYLIB
    Created: 4th March, 2021
*/

/* Download oracle driver and client from the oracle website */
task downloadOraClient(type: Task) {
  group = 'Oracle'
  description = 'Download Oracle client zip file'
  doLast {
    def lib_dir = "${project.rootDir}/lib"
    def uri = 'https://download.oracle.com/otn_software/mac/instantclient/193000/instantclient-basiclite-macos.x64-19.3.0.0.0dbru.zip'
    mkdir lib_dir
    exec {
      commandLine 'curl', '-o', "${lib_dir}/instantclient.zip", '-O', uri
    }
  }
}

/* Install the oracle driver and client into the system */
task installOraClient(dependsOn: downloadOraClient, type: Task) {
  group = 'Oracle'
  description = 'Download and install Oracle client libraries'
  doLast {
    def lib_dir = "${project.rootDir}/lib"
    copy {
      from zipTree("${lib_dir}/instantclient.zip")
      into "${lib_dir}"
    }
    delete "${lib_dir}/instantclient.zip"
  }
}
