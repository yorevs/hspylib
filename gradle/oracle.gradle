/*
    Gradle Oracle integration extension
    Project: HSPyLib
    Created: 4th March, 2021
*/

def libDir = "${project.rootDir}/lib"
def clientAppFile = "instantclient_19_3.zip"
def uri = "https://download.oracle.com/otn_software/mac/instantclient/193000/instantclient-basiclite-macos.x64-19.3.0.0.0dbru.zip"
def outFile = "${libDir}/${clientAppFile}"

/* Download oracle driver and client from the oracle website */
task downloadOraClient(type: Task) {
  group = 'Oracle'
  description = 'Download Oracle client zip file'
  doLast {
    println "Downloading oracle client and driver"
    println "  From: ${uri}"
    println "  Into: ${outFile}"
    mkdir libDir
    exec {
      commandLine 'curl', '-o', "${outFile}", '-O', uri
    }
  }
}

/* Install the oracle driver and client into the system */
task installOraClient(dependsOn: downloadOraClient, type: Task) {
  group = 'Oracle'
  description = 'Download and install Oracle client libraries'
  doLast {
    println "Extracting oracle client and driver"
    println "  From: ${outFile}"
    println "  Into: ${libDir}"
    copy {
      from zipTree("${outFile}")
      into "${libDir}"
    }
  }
}
