
buildscript {
  project.ext.gradleProperties = "$rootProject.projectDir/properties.gradle"
  apply from: gradleProperties
}

apply from: "properties.gradle"

ext {
  startTime = System.currentTimeMillis()
  python = "python${pythonVersion}"
  pyrcc = "pyrcc3${pyrccVersion}"
  sourceRoot = "${rootDir}/src"
  application = "main.py"
  version = "0-9.10"
  versionFile = "VERSION"
  deps = [
    'PyQt5',
    'PyQt5-stubs',
    'cryptography',
    'pycodestyle',
    'pymysql',
    'requests'
  ]
  containers = [
    'mysql'
  ]
}

wrapper {
  gradleVersion="${gradleVersion}"
}

apply from: "gradle/docker.gradle"
apply from: "gradle/python.gradle"

task downloadOraClient(type: Task) {
  description = 'Download Oracle client zip file'
  doLast {
    def lib_dir = "${project.rootDir}/lib"
    def uri = 'https://download.oracle.com/otn_software/mac/instantclient/193000/instantclient-basiclite-macos.x64-19.3.0.0.0dbru.zip'
    mkdir lib_dir
    exec {
      commandLine 'curl', '-o', "${lib_dir}/instantclient.zip", '-O', uri
    }
  }
}

task installOraClient(dependsOn: downloadOraClient, type: Task) {
  group = 'Install'
  description = 'Download and install Oracle client libraries'
  doLast {
    def lib_dir = "${project.rootDir}/lib"
    copy {
      from zipTree("${lib_dir}/instantclient.zip")
      into "${lib_dir}"
    }
    delete "${lib_dir}/instantclient.zip"
  }
}
