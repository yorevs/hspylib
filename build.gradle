/*
    Gradle root build file
    Project: HSPyLib
    Created: 1st July, 2020
*/
plugins {
  id 'idea'
  id "org.jetbrains.gradle.plugin.idea-ext" version "1.1.4"
}

idea {
  module {
    settings {
      rootModuleType = 'PYTHON_MODULE'
    }
    excludeDirs += file('.vscode')
    excludeDirs += file('run-configs')
  }
}

subprojects {

  tasks.withType(Exec) {
    doFirst {
      println commandLine
    }
  }

  apply from: "$projectDir/gradle.properties"
}

ext {
  python = "python${pythonVersion}"
  pyrcc = "pyrcc3${pyrccVersion}"
  startTime = System.currentTimeMillis()
  verbose = project.hasProperty('verbose') ? verbose : false
}

/* Install hspylib build tools */
task installBuildTools {
  group = 'Install'
  description = 'Install hspylib build tools'
  doLast {
    println "Upgrading pip module to the latest "
    readDependencies()
    exec {
      commandLine rootProject.python, '-m', 'ensurepip', '-q', '--upgrade'
      commandLine rootProject.python, '-m', 'pip', '-q', 'install', '--upgrade', 'pip'
    }
    def build_tools = ['setuptools', 'pipenv', 'bumpver', 'pylint', 'twine', 'wheel']
    build_tools.each { tool ->
      exec {
        commandLine rootProject.python, '-m', 'pip', 'install', '--upgrade', tool
      }
    }
  }
}
